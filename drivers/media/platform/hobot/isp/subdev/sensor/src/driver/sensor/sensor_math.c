#include "acamera_math.h"


//input --- output ===>2^(m/32)
//output --->Ux.8  ===>(uint32_t)(2^(m/32)*256 + 0.5)
//input ---> Ux.8  ===> check gain_map[]

uint32_t gain_map[257] = {
	256, 261, 267, 273, 279, 285, 291, 297, 304, 311, 317, 324, 331,     
	339, 346, 354, 362, 369, 378, 386, 394, 403, 412, 421, 430, 439,     
	449, 459, 469, 479, 490, 501, 512, 523, 534, 546, 558, 570, 583,     
	595, 608, 622, 635, 649, 663, 678, 693, 708, 724, 739, 756, 772,     
	789, 806, 824, 842, 861, 879, 899, 918, 939, 959, 980, 1002, 1024,   
	1046, 1069, 1092, 1116, 1141, 1166, 1191, 1217, 1244, 1271, 1299,    
	1327, 1357, 1386, 1417, 1448, 1479, 1512, 1545, 1579, 1613, 1649,    
	1685, 1722, 1759, 1798, 1837, 1878, 1919, 1961, 2004, 2048, 2092,    
	2138, 2185, 2233, 2282, 2332, 2383, 2435, 2488, 2543, 2599, 2655,    
	2714, 2773, 2834, 2896, 2959, 3024, 3090, 3158, 3227, 3298, 3370,    
	3444, 3519, 3596, 3675, 3756, 3838, 3922, 4008, 4096, 4185, 4277,    
	4371, 4466, 4564, 4664, 4766, 4870, 4977, 5086, 5198, 5311, 5428,    
	5547, 5668, 5792, 5919, 6049, 6181, 6316, 6455, 6596, 6741, 6888,    
	7039, 7193, 7351, 7512, 7676, 7844, 8016, 8192, 8371, 8554, 8742,    
	8933, 9129, 9328, 9533, 9741, 9955, 10173, 10396, 10623, 10856,      
	11094, 11336, 11585, 11838, 12098, 12363, 12633, 12910, 13193,       
	13482, 13777, 14078, 14387, 14702, 15024, 15353, 15689, 16032, 16384,
	16742, 17109, 17484, 17866, 18258, 18657, 19066, 19483, 19910, 20346,
	20792, 21247, 21712, 22188, 22673, 23170, 23677, 24196, 24726, 25267,
	25820, 26386, 26964, 27554, 28157, 28774, 29404, 30048, 30706, 31378,
	32065, 32768, 33485, 34218, 34968, 35734, 36516, 37316, 38133, 38968,
	39821, 40693, 41584, 42495, 43425, 44376, 45348, 46341, 47356, 48393,
	49452, 50535, 51642, 52773, 53928, 55109, 56316, 57549, 58809, 60097,
	61413, 62757, 64132, 65536 
};

/*
 * log10(x) = log2(x) * log10(2)
 * log2(x*256) = log2(x) + log2(256)
 * input U -x.y ==> y = 8
 * output U-x.y ==> y = 8 
 */

uint32_t sensor_log10(uint32_t val)
{
	uint32_t data_log2 = 0;
	uint32_t data_log10 = 0;

	if (val == 0)
		return 0;
//  y = log2(x)
//
//    input:  Integer: val
//    output: Fixed point x.y
//    y: out_precision
//
	val = gain_map[val];
	data_log2 = acamera_log2_int_to_fixed( val , 8, 0) - 2048; // ux.8
	data_log10 = ((data_log2 * 617) >> 11); 

        return data_log10;
}

